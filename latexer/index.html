<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LaTeXeR</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="stylesheet" href="style.css">
  <link rel="manifest" href="manifest.json">
</head>
<body>

  <div id="connectivityBanner" style="display:none;">
    <span id="connectivitySpinner" class="fa fa-sync fa-spin" style="color:black; margin-right:5px;"></span>
    <span>Your internet connectivity is slow or down. Retrying sync in </span>
    <span id="retryCountdown">10</span>
    <span> seconds...</span>
  </div>
  <div id="onlineBanner" style="display:none; position: fixed; bottom: 0; left: 0; right: 0; background-color: rgba(0,128,0,0.7); color: #fff; text-align: center; padding: 5px; font-size: 12px; z-index: 1051;">
    Yay, we're back online!
  </div>
  <div id="saveNotification" style="display:none; position: fixed; top: 0; left: 0; right: 0; background-color: #337ab7; color: #fff; text-align: center; padding: 5px; font-size: 12px; z-index: 1052;">
    No need to save manually â€“ changes are automatically saved as you go!
  </div>

  <div id="header">
    <div style="display: flex; align-items: center;">
      <img src="https://raw.githubusercontent.com/SulmanOlieko/sulmanolieko.github.io/main/img/ekonly-logo.svg" style="height:40px; width:auto; margin-right:10px;">
      <h1 style="margin: 0;">LaTeXeR</h1>
    </div>
    <div>
      <button id="compile" class="btn btn-success">Compile <span id="compileSpinner" style="display:none;"><i class="fa fa-spinner fa-spin"></i></span></button>
      <button id="openSettings" class="btn btn-default" style="margin-left:10px;" title="Settings"><i class="fas fa-cog"></i></button>
    </div>
  </div>

  <div id="settingsPanel" class="settings-panel" style="display:none;">
      <h4>Settings</h4>
      <div class="setting-item">
        <label for="editorThemePanel">Editor Theme</label>
        <select id="editorThemePanel">
          <option value="ace/theme/tomorrow">tomorrow</option>
          <option value="ace/theme/monokai">monokai</option>
          <option value="ace/theme/github">github</option>
          <option value="ace/theme/solarized_dark" selected>solarized_dark</option>
          <option value="ace/theme/solarized_light">solarized_light</option>
        </select>
      </div>
      <div class="setting-item">
          <label for="editorFontSizePanel">Font Size</label>
          <input type="range" id="editorFontSizePanel" min="8" max="32" value="12">
      </div>
      <div class="setting-item material-switch">
        <label for="showDockerConsole">Docker Console</label>
        <input id="showDockerConsole" type="checkbox" />
        <label for="showDockerConsole" class="label-primary"></label>
      </div>
      <div class="setting-item material-switch">
        <label for="showPdfPreview">PDF Preview</label>
        <input id="showPdfPreview" type="checkbox" checked/>
        <label for="showPdfPreview" class="label-primary"></label>
      </div>
      <div class="setting-item material-switch">
        <label for="editorWordWrap">Word Wrap</label>
        <input id="editorWordWrap" type="checkbox" checked/>
        <label for="editorWordWrap" class="label-primary"></label>
      </div>
      <div class="setting-item material-switch">
        <label for="editorLineNumbers">Line Numbers</label>
        <input id="editorLineNumbers" type="checkbox" checked/>
        <label for="editorLineNumbers" class="label-primary"></label>
      </div>
      <div class="setting-item material-switch">
        <label for="showPrintMargin">Print Margin</label>
        <input id="showPrintMargin" type="checkbox" checked/>
        <label for="showPrintMargin" class="label-primary"></label>
      </div>
      <div class="setting-item material-switch">
        <label for="enableAutocomplete">Autocomplete</label>
        <input id="enableAutocomplete" type="checkbox" checked/>
        <label for="enableAutocomplete" class="label-primary"></label>
      </div>
      <button id="closeSettings" class="btn btn-secondary" style="margin-top:10px;">Close</button>
  </div>

  <div id="mainArea">
    <div id="fileSidebar">
      <div class="well">
        <label for="compileMainFile">Select Main .tex File</label>
        <select id="compileMainFile">
          <option>main.tex</option>
        </select>
      </div>
      <div class="well">
        <div style="display: flex; gap: 10px; margin-bottom: 10px; justify-content: flex-end;">
            <a id="newFile" href="#" title="New File"><i class="fas fa-file"></i></a>
            <a id="newFolder" href="#" title="New Folder"><i class="fas fa-folder-plus"></i></a>
        </div>
        <label for="uploadFiles" class="btn">Upload Files</label>
        <input type="file" id="uploadFiles" multiple style="display: none;">
      </div>
      <div class="well">
        <h4>Project Files</h4>
        <div class="bulk-actions">
            <button id="bulkDownloadUploaded" class="btn btn-default">Download All</button>
            <button id="bulkDeleteUploaded" class="btn btn-danger">Delete All</button>
        </div>
        <div id="fileListSidebar">
            <p>No files in project.</p>
        </div>
      </div>
      <div class="well">
        <h4>Compiled Files</h4>
        <div class="bulk-actions">
            <button id="bulkDownloadCompiled" class="btn btn-default">Download All</button>
            <button id="bulkDeleteCompiled" class="btn btn-danger">Delete All</button>
        </div>
        <div id="compiledFileList">
            <p>No compiled files.</p>
        </div>
      </div>
    </div>

    <div id="editorArea">
      <div id="statusBar" style="height:40px; padding:5px 10px; display:flex; align-items:center; justify-content:space-between;">
          <span id="statusText">No file selected</span>
          <div id="toggleContainer" class="material-switch">
            <label for="viewMode">Visual Editor</label>
            <input id="viewMode" type="checkbox"/>
            <label for="viewMode" class="label-primary"></label>
          </div>
      </div>
      <div id="editorSplit" style="height: calc(100% - 40px); position:relative;">
          <div id="codeEditorContainer" style="height:100%;">
              <div id="sourceEditor" style="height:100%;"></div>
          </div>
          <div id="visualEditorContainer" style="height:100%; display:none; position:absolute; top:0; left:0; right:0; bottom:0;">
              <div id="visualToolbar" style="margin-bottom:5px;">
                  <button id="v_bold" class="btn btn-secondary btn-sm" title="Bold"><i class='fa fa-bold'></i></button>
                  <button id="v_italic" class="btn btn-secondary btn-sm" title="Italic"><i class='fa fa-italic'></i></button>
                  <button id="v_underline" class="btn btn-secondary btn-sm" title="Underline"><i class='fa fa-underline'></i></button>
                  <button id="v_section" class="btn btn-secondary btn-sm" title="Section">Sec</button>
                  <button id="v_subsection" class="btn btn-secondary btn-sm" title="Subsection">Subsec</button>
                  <button id="v_itemize" class="btn btn-secondary btn-sm" title="Itemize"><i class='fa fa-list-ul'></i></button>
              </div>
              <div id="visualEditor" contenteditable="true" style="height:calc(100% - 30px); overflow-y:auto; white-space:pre-wrap; outline:none;"></div>
          </div>
      </div>
    </div>

    <div id="pdfPreview">
      <div class="pdf-header"><h4>PDF Preview</h4></div>
      <div id="pdfContainer" style="flex-grow: 1; position: relative;">
          <div id="pdfViewUI" style="height: 100%; width: 100%;">
            <p style="text-align: center; padding-top: 50px;">PDF preview will appear here after compilation.</p>
          </div>
      </div>
      <div id="dockerConsoleContainer">
          <div id="dockerConsole" style="height: 100%;"></div>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/split.js/dist/split.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="script.js"></script>

  <!-- Simple Modal for Input -->
  <div id="inputModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <h4 id="modalTitle">Create New</h4>
      <div class="modal-body">
        <p id="modalMessage" style="display: none;"></p>
        <div id="modalInputContainer">
            <label for="modalInput">Name:</label>
            <input type="text" id="modalInput" style="width: 100%;">
        </div>
        <p id="modalError" style="color: red; display: none;"></p>
      </div>
      <div class="modal-footer">
        <button id="modalCancel" class="btn btn-secondary">Cancel</button>
        <button id="modalOk" class="btn btn-primary">OK</button>
      </div>
    </div>
  </div>
  <style>
    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1100; display: flex; align-items: center; justify-content: center; }
    .modal-content { width: 400px; }
    .modal-footer { margin-top: 10px; display: flex; justify-content: flex-end; gap: 10px; }
    #previewModal .modal-content { width: 80vw; height: 80vh; }
    #preview-content { height: calc(100% - 80px); overflow: auto; }
  </style>

  <!-- Preview Modal -->
  <div id="previewModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <h4 id="previewTitle">Preview</h4>
      <div id="preview-content" class="modal-body"></div>
      <div class="modal-footer">
        <button id="previewClose" class="btn btn-secondary">Close</button>
      </div>
    </div>
  </div>
</body>
</html>
